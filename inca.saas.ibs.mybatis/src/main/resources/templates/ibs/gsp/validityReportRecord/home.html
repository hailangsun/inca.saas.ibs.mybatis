<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head>
<title>门店近效期催销记录</title>
<meta charset="UTF-8"></meta>
<script th:src="@{/lib/miniui/boot.js}"></script>
<style type="text/css">
.mini-pager-size .mini-combobox{
	width:63px;
}
.mini-buttonedit-input{
	line-height:20px;
}

</style>

</head>
<body>

	<div>
		<div class="mini-toolbar" style="border-bottom: 0; padding: 0px;">
			<table style="width: 100%;">
				<tr>
					<td style="white-space: nowrap;" align="center"><span>检索</span>
						<input id="keyword" class="mini-textbox" emptyText="商品编码/生产厂商" style="width: 150px;" />&nbsp; 
						<a class="mini-button" onclick="search()">查询</a></td>
				</tr>
			</table>
		</div>
		<!-- <div id="validityReportRecordGrid" class="mini-datagrid" style="height: 750px;" url="/IBSGSP347/miniuiSearch" idField="id" allowResize="true" pageSize="20"
			 multiSelect="true" >
			<div property="columns">
				<div type="indexcolumn"></div>
				<div field="goods_code" width="120" headerAlign="center" allowSort="true">商品编号</div> 
                <div field="goods_name" width="100" headerAlign="center" allowSort="true">通用名</div> 
                <div field="goods_opcode" width="120" headerAlign="center" allowSort="true">助记码</div> 
                <div field="goods_spec" width="120" headerAlign="center" allowSort="true">规格</div> 
                <div field="goods_unit" width="120" headerAlign="center" allowSort="true">基本单位</div> 
			</div>
		</div> -->
	<div class="mini-toolbar" style="border-bottom: 0; padding: 0px;padding-top:10px;padding-bottom:5px;">
			<table style="width: 100%;">
				<tr>
					<td style="width: 100%;">
					<a class="mini-button mini-ibs-btn"  onclick="doDtlExport()" id="exportDtlExcel" plain="true">导出</a> 
					</td>
				</tr>
			</table>
	</div>
	<div id="validityReportRecordGrid" class="mini-datagrid" style="height:750px;" url="/IBSGSP347/miniuiSearch" allowCellEdit="true" allowCellSelect="true">
	</div>
		
	</div> 
	
	


	<script th:inline="javascript">
	//<![CDATA[
	mini.parse();
	var grid = mini.get("validityReportRecordGrid");
	var columns = /*[[${columns}]]*/;
	grid.set(columns);
	grid.load();
	
	function toNext(e){
		debugger;
		console.info(e);
	}
	
	//查询
  	function search() {
		
// 		//关键字过滤
//     	var keyword = mini.get("keyword").getValue();
//     	var busiDateFrom = mini.get("busiDateFrom").getValue();
//     	var busiDateTo = mini.get("busiDateTo").getValue();
// 	   	 if(busiDateFrom!=""){
// 	   		 busiDateFrom=busiDateFrom+"";
// 	        }
// 	   	 if(busiDateTo!=""){
// 	   		 busiDateTo=busiDateTo+"";
// 	        }
    	 
//       grid.load({ keyword: keyword,busiDateFrom:busiDateFrom,busiDateTo:busiDateTo});
    }
	
	function doDtlExport(){
		doExport(grid);
	}
	
	function doExport(grid){
		var uri='/IBSGSP347/export';
		$("#columnsJson").val(mini.encode(getExpColumns(grid)));
		$("#export_form").attr("action",uri).submit();
	}
	$(document).ready(function(){
		var exp_f=$('<form id="export_form" name ="export_iframe" target="_bland" method="POST"> <input id="columnsJson" type="hidden" name="columnsJson"  type="text" /></form>');
		$("body").append(exp_f);
	});
	
	
	function getExpColumns(exportGrid){
		//获取表列
	    var columns = exportGrid.columns;
	    function getColumns(columns) {
	        var cols = [];
	        for (var i = 0; i < columns.length; i++) {
	            var column = columns[i];
	            var col = { header: column.header, field: column.field, type: column.type };
	            if (column.columns) {
	                col.columns = getColumns(column.columns);
	            }
	            cols.push(col);
	        }
	        return cols;
	    }
	    var columns = getColumns(columns);
	    //添加细单导出总单单据编号
// 	    var documentCodeTemp = { header: "单据编号", field: "document_code"};
// 	    columns.push(documentCodeTemp);
	    return columns;
	}
	
      //]]> 	
    </script>



</body>
</html>